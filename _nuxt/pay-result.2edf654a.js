import{a as d,m as f,p as l,q as _,y as m,k as g,O as y}from"./entry.b980ff2a.js";import{u as k}from"./index.b7543822.js";import{c as i}from"./confetti.module.249a7e39.js";const R=d({__name:"pay-result",setup(h){const u=f(),n=l(),a=k(),{$toast:r}=_();function c(){const s=Date.now()+1e3,e=["#FA5477","#249FFD"];function t(){i({particleCount:2,angle:60,spread:55,origin:{x:0},colors:e}),i({particleCount:2,angle:120,spread:55,origin:{x:1},colors:e}),Date.now()<s&&requestAnimationFrame(t)}t()}function p(s){a.$state.loading=!0,a.apiPayCheckOrder(s).then(async e=>{if(a.$state.loading=!1,e.status){if(s){const t=await g("order")||[];t.forEach(o=>{o.orderNo===s&&(o.status=e.status,o.key=e.data.key)}),a.$state.APIConfig.key=e.data.key,await y("order",t)}r.success("支付成功"),c(),n.replace("/user")}else r.error("支付失败或未支付")}).catch(e=>{let t=e.message;e.response&&e.response._data&&e.response._data.error&&(t=e.response._data.error.message),a.$state.loading=!1,r.error(`出现错误，请检查密钥和网络：${JSON.stringify(t)}`)})}return m(()=>{const s=u.query,{out_trade_no:e,method:t,total_amount:o,sign:$,trade_no:w,auth_app_id:C,version:q,app_id:x,sign_type:A,seller_id:F,timestamp:O}=s;e?p(e):n.replace("/user")}),()=>{}}});export{R as default};
