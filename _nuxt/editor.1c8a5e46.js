import{_ as j}from"./nuxt-link.60028201.js";import{c as Q,_ as W,a as B,I as M,b as X}from"./Navbar.0f0e4624.js";import{_ as Y}from"./Container.856f971b.js";import{_ as Z}from"./Dialog.876fc127.js";import{a as ee,L as te,q as se,p as oe,m as le,s as g,x as ne,v as ae,y as re,o as c,b as _,f as d,i as h,e as t,u as e,c as q,A as f,k as N,B as r,C as I,t as m,D as v,F as ie,G as ue,h as ce,O as de}from"./entry.b980ff2a.js";import{u as pe}from"./index.b7543822.js";import{c as me}from"./index.browser.bef4f1f3.js";import{I as _e}from"./IconTools.9f3744e7.js";import{I as fe}from"./IconSquareRoundedPlus.e2c27dfe.js";import{I as ye}from"./IconMessageCircle.d3b08c7c.js";import{I as ve}from"./IconPlus.e8cb4070.js";import"./LoadingSvg.54a92436.js";var be=Q("share","IconShare",[["path",{d:"M6 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-0"}],["path",{d:"M18 6m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-1"}],["path",{d:"M18 18m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-2"}],["path",{d:"M8.7 10.7l6.6 -3.4",key:"svg-3"}],["path",{d:"M8.7 13.3l6.6 3.4",key:"svg-4"}]]);function F(C){let P,i=C[0],a=1;for(;a<C.length;){const x=C[a],$=C[a+1];if(a+=2,(x==="optionalAccess"||x==="optionalCall")&&i==null)return;x==="access"||x==="optionalAccess"?(P=i,i=$(i)):(x==="call"||x==="optionalCall")&&(i=$((...u)=>i.call(P,...u)),P=void 0)}return i}const xe={class:"page-tools-editor"},he=t("span",null,"创建工具",-1),ge={class:"button button-theme button-icon"},ke=t("span",null,"使用工具",-1),we={class:"button button-normal button-icon ml-4"},Ce=t("span",null,"创建新的工具",-1),Pe=t("span",null,"分享工具",-1),$e={class:"mb-4 text-xl font-bold"},Ve={class:"mb-4 text-sm"},Ae=t("label",{for:"create-tools-title",class:"mb-2 block"},"标题",-1),Ie={class:"mb-4 text-sm"},Ue=t("label",{for:"create-tools-system-prompt",class:"mb-2 block"},"提示词",-1),qe={class:"mb-4 text-sm"},Te=t("label",{for:"create-tools-system-prompt-prefix",class:"mb-2 block"},"提示词前缀（选填）",-1),De={class:"mb-4 text-sm"},Se=t("label",{for:"create-tools-desc",class:"mb-2 block"},"工具描述",-1),ze={class:"mb-4 text-sm"},Be=t("label",{for:"create-tools-placeholder",class:"mb-2 block"},"输入框提示（选填）",-1),Me=t("span",{class:"mr-1"},"高级设置",-1),Ne=t("hr",{class:"mb-4"},null,-1),Fe=t("div",{class:"mb-4 text-xl font-bold"},"高级设置",-1),Re={class:"editor-range mb-4"},Je={for:"create-tools-top-p-range"},Oe={class:"editor-range mb-4"},Ee={for:"create-tools-temperature-range"},Ge={class:"editor-range mb-4"},He={for:"create-tools-presence-penalty-range"},Ke={class:"editor-range mb-4"},Le={for:"create-tools-frequency-penalty-range"},je={class:"editor-range mb-4"},Qe={for:"create-tools-max-tokens-range"},We={class:"mb-4"},Xe=t("div",{class:"absolute left-0 top-0 ml-2 mt-2 text-xs text-gray-400"},"预览",-1),Ye={class:"mb-2 text-xl font-bold"},Ze={key:0,class:"mb-4"},et={key:1,class:"mb-3"},tt={class:"text-xs"},st=["placeholder"],ot={key:0,class:"mb-4"},lt=t("hr",{class:"mb-4"},null,-1),nt={class:"mb-4"},at={key:0},rt={key:1},it={key:2},ut=t("span",{class:"mr-1"},"查看 JSON",-1),ct={key:1,class:"mb-4"},dt=t("hr",{class:"mb-4"},null,-1),pt=t("div",{class:"mb-2 text-xs"},"请求：",-1),mt={class:"mb-4 overflow-x-auto rounded-md bg-theme-50 p-4 text-sm dark:bg-slate-800"},_t={key:0,class:"mb-2 text-xs"},ft={key:1,class:"overflow-x-auto rounded-md bg-theme-50 p-4 text-sm dark:bg-slate-800"},yt={class:"pay-wait-dialog mb-6 leading-8"},vt=t("p",null,"审核成功后将在创意工坊显示，分享后不可撤销",-1),Ut=ee({__name:"editor",setup(C){const P=me("1234567890abcdefghijklmnopqrstuvwxyz",10);te({title:"创建 AI 工具"});const i=pe(),{$toast:a}=se(),x=oe(),$=le(),u=g({key:null,value:null}),T={title:"",systemPrompt:"",systemPromptPrefix:"",placeholder:"",description:"",supportContext:!1,top_p:1,temperature:.7,presence_penalty:0,frequency_penalty:0,max_tokens:2e3},s=g(T),k=g(!1),w=g(""),V=g(!1),D=ne(()=>({model:i.$state.APIConfig.model,top_p:s.value.top_p,temperature:s.value.temperature,presence_penalty:s.value.presence_penalty,frequency_penalty:s.value.frequency_penalty,messages:[{role:"system",content:s.value.systemPrompt},{role:"user",content:`${s.value.systemPromptPrefix}${w.value}`}]}));async function R(n=!1){if(!i.$state.APIConfig.key)return a.error("请点击右上角配置 API Key");if(!s.value.title.trim()){a.warning("请输入工具名称");return}if(!s.value.systemPrompt.trim()){a.warning("请输入工具提示");return}if(!s.value.description.trim()){a.warning("请输入工具描述");return}const o=n?u.value.key:`tool-${P()}`;if(!o){a.warning("工具不存在");return}let b;n?(b=await N(o),b={...b,...s.value,updatedAt:new Date().getTime()}):b={...s.value,id:o,version:1,createdAt:new Date().getTime(),lastUsedAt:new Date().getTime(),updatedAt:new Date().getTime(),createUser:i.$state.user.mail||"local"};try{await de(o,b)}catch{return n?a.error("更新工具失败，无法读取 indexedDB 数据库，请关闭隐身模式或更换浏览器"):a.error("创建工具失败，无法读取 indexedDB 数据库，请关闭隐身模式或更换浏览器")}n?a.success("更新工具成功"):a.success("创建工具成功"),u.value={key:o,value:b},x.replace({query:{id:o}})}const y=g(null),p=g(null);function J(){if(!w.value.trim()){a.warning("请输入测试内容");return}y.value=null,p.value=null,i.$state.loading=!0,i.apiCompletion(D.value,{stream:!1}).then(n=>{i.$state.loading=!1,y.value=n}).catch(async n=>{if(n.response&&n.response._data){const o=await n.response._data;p.value=o}else p.value=n;i.$state.loading=!1,a.error(`测试工具失败，${n.message}`)})}function O(){s.value=T,k.value=!1,w.value="",y.value=null,p.value=null,u.value={key:null,value:null}}const A=g({open:!1});function E(){A.value.open=!0}function G(){A.value.open=!1}function H(){if(!u.value.key){a.warning("工具不存在");return}A.value.open=!0}function S(){let{id:n}=$.query;n?N(n).then(o=>{if(!o)return x.replace("/tools/editor"),a.error(`无法读取工具，请检查工具【${n}】是否存在`);u.value={key:n,value:o},s.value={...s.value,...o}}):O()}return ae(()=>$.query,()=>{S()}),re(()=>{S()}),(n,o)=>{const b=j,z=W,U=Y,K=X,L=Z;return c(),_("div",xe,[d(z,{shadow:"",fixed:""},{"nav-left":h(()=>[r(d(b,{to:"/tools",class:"nav-item",title:"返回工具列表"},{default:h(()=>[d(e(_e))]),_:1},512),[[I,n.$route.path!=="/"]])]),"nav-center":h(()=>[d(e(fe)),he]),_:1}),t("main",null,[e(u).key?(c(),q(U,{key:0},{default:h(()=>[e(u).key?(c(),q(b,{key:0,to:`/chat?type=tool&tool=${e(u).key}`},{default:h(()=>[t("button",ge,[d(e(ye),{size:16,class:"mr-1"}),ke])]),_:1},8,["to"])):f("",!0),d(b,{to:"/tools/editor"},{default:h(()=>[t("button",we,[d(e(ve),{size:16,class:"mr-1 text-gray-500"}),Ce])]),_:1}),t("button",{onClick:H,class:"button button-normal button-icon ml-4"},[d(e(be),{size:16,class:"mr-1 text-gray-500"}),Pe])]),_:1})):f("",!0),d(U,null,{default:h(()=>[t("div",$e,m(e(u).key?`编辑工具：${e(u).value.title}`:"创建工具："),1),t("div",null,[t("div",Ve,[Ae,r(t("input",{"onUpdate:modelValue":o[0]||(o[0]=l=>e(s).title=l),id:"create-tools-title",class:"w-full",type:"text",placeholder:"例如：日报生成器"},null,512),[[v,e(s).title]])]),t("div",Ie,[Ue,r(t("textarea",{rows:"5","onUpdate:modelValue":o[1]||(o[1]=l=>e(s).systemPrompt=l),id:"create-tools-system-prompt",class:"w-full",type:"text",placeholder:"例如：请帮我把以下的工作内容填充为一篇完整的周报，以分点叙述的形式输出"},null,512),[[v,e(s).systemPrompt]])]),d(K,{name:"支持联系上下文",modelValue:e(s).supportContext,"onUpdate:modelValue":o[2]||(o[2]=l=>e(s).supportContext=l),class:"mb-4"},null,8,["modelValue"]),t("div",qe,[Te,r(t("input",{"onUpdate:modelValue":o[3]||(o[3]=l=>e(s).systemPromptPrefix=l),id:"create-tools-system-prompt-prefix",class:"w-full",type:"text",placeholder:"例如：今天我的主要工作有："},null,512),[[v,e(s).systemPromptPrefix]])]),t("div",De,[Se,r(t("textarea",{rows:"5","onUpdate:modelValue":o[4]||(o[4]=l=>e(s).description=l),id:"create-tools-desc",class:"w-full",type:"text",placeholder:"例如：帮你生成一份工作日报"},null,512),[[v,e(s).description]])]),t("div",ze,[Be,r(t("input",{"onUpdate:modelValue":o[5]||(o[5]=l=>e(s).placeholder=l),id:"create-tools-placeholder",class:"w-full",type:"text",placeholder:"例如：写代码、修bug"},null,512),[[v,e(s).placeholder]])]),t("div",{class:"mb-4 inline-flex cursor-pointer items-center text-xs text-theme",onClick:o[6]||(o[6]=l=>k.value=!e(k))},[Me,r(d(e(B),{size:14},null,512),[[I,!e(k)]]),r(d(e(M),{size:14},null,512),[[I,e(k)]])]),e(k)?(c(),_(ie,{key:0},[Ne,Fe,t("div",Re,[t("label",Je,"top_p: "+m(e(s).top_p),1),r(t("input",{"onUpdate:modelValue":o[7]||(o[7]=l=>e(s).top_p=l),id:"create-tools-top-p-range",type:"range",min:"0",max:"1",step:"0.1"},null,512),[[v,e(s).top_p]])]),t("div",Oe,[t("label",Ee,"temperature: "+m(e(s).temperature),1),r(t("input",{"onUpdate:modelValue":o[8]||(o[8]=l=>e(s).temperature=l),id:"create-tools-temperature-range",type:"range",min:"0",max:"2",step:"0.1"},null,512),[[v,e(s).temperature]])]),t("div",Ge,[t("label",He,"presence_penalty: "+m(e(s).presence_penalty),1),r(t("input",{"onUpdate:modelValue":o[9]||(o[9]=l=>e(s).presence_penalty=l),id:"create-tools-presence-penalty-range",type:"range",min:"-2",max:"2",step:"0.1"},null,512),[[v,e(s).presence_penalty]])]),t("div",Ke,[t("label",Le,"frequency_penalty: "+m(e(s).frequency_penalty),1),r(t("input",{"onUpdate:modelValue":o[10]||(o[10]=l=>e(s).frequency_penalty=l),id:"create-tools-frequency-penalty-range",type:"range",min:"-2",max:"2",step:"0.1"},null,512),[[v,e(s).frequency_penalty]])]),t("div",je,[t("label",Qe,"max_tokens: "+m(e(s).max_tokens),1),r(t("input",{"onUpdate:modelValue":o[11]||(o[11]=l=>e(s).max_tokens=l),id:"create-tools-max-tokens-range",type:"range",min:"100",max:"4000",step:"100"},null,512),[[v,e(s).max_tokens]])])],64)):f("",!0),t("button",{class:"button button-theme block",onClick:o[12]||(o[12]=l=>R(!1))},"添加工具")])]),_:1}),e(s).title&&e(s).systemPrompt||e(u).key?(c(),q(U,{key:1,class:""},{default:h(()=>[t("div",We,[Xe,t("div",Ye,m(e(s).title),1),e(s).description?(c(),_("div",Ze,m(e(s).description),1)):f("",!0),e(s).systemPromptPrefix?(c(),_("div",et,[t("div",tt,m(e(s).systemPromptPrefix),1),r(t("textarea",{"onUpdate:modelValue":o[13]||(o[13]=l=>ue(w)?w.value=l:null),rows:"5",class:"w-full",type:"text",placeholder:e(s).placeholder},null,8,st),[[v,e(w)]])])):f("",!0),t("button",{class:"button button-theme mt-2",onClick:J},"测试工具")]),e(y)||e(p)?(c(),_("div",ot,[lt,t("div",nt,[e(p)?(c(),_("span",at,"测试出错：")):(c(),_("span",rt,"测试结果：")),e(y)?(c(),_("span",it,m(e(y).usage.total_tokens)+" Tokens",1)):f("",!0)]),e(p)?(c(),_("div",{key:0,class:ce(["overflow-x-auto whitespace-pre rounded-md bg-theme-50 p-4 dark:bg-slate-800",{"text-red-400":e(p)}])},m(e(y)?e(y).choices[0].message.content:e(p).error?e(p).error.message:e(p)),3)):f("",!0)])):f("",!0),t("div",{class:"mb-4 inline-flex cursor-pointer items-center text-xs text-theme",onClick:o[14]||(o[14]=l=>V.value=!e(V))},[ut,r(d(e(B),{size:14},null,512),[[I,!e(V)]]),r(d(e(M),{size:14},null,512),[[I,e(V)]])]),e(V)?(c(),_("div",ct,[dt,pt,t("pre",mt,m(JSON.stringify(e(D),null,4)),1),e(y)||e(p)?(c(),_("div",_t,"返回：")):f("",!0),e(y)||e(p)?(c(),_("pre",ft,m(JSON.stringify(e(y)||e(p),null,4)),1)):f("",!0)])):f("",!0)]),_:1})):f("",!0)]),d(L,{visible:e(A).open,"onUpdate:visible":o[15]||(o[15]=l=>e(A).open=l),title:`分享工具【${F([e,"call",l=>l(u),"access",l=>l.value,"optionalAccess",l=>l.title])}】`,cancelButtonText:"取消",confirmButtonText:"分享",size:"md",onConfirm:E,onCancel:G},{content:h(()=>[t("div",yt,[t("p",null,"是否分享工具【"+m(F([e,"call",l=>l(u),"access",l=>l.value,"optionalAccess",l=>l.title]))+"】到创意工坊",1),vt])]),_:1},8,["visible","title"])])}}});export{Ut as default};
